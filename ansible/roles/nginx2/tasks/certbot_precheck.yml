# ----------------------------
# Ensure Certbot is installed
# ----------------------------
- name: Ensure certbot is installed
  become: true
  apt:
    name: certbot
    state: present
    update_cache: true

# ----------------------------
# Ensure webroot exists for ACME challenge
# ----------------------------
- name: Ensure webroot exists for ACME challenge
  become: true
  file:
    path: /opt/dearlavion/certbot-webroot
    state: directory
    owner: root
    group: root
    mode: '0755'

# ----------------------------
# Fix ownership for Certbot
# ----------------------------
- name: Ensure certbot webroot has correct ownership
  become: true
  file:
    path: /opt/dearlavion/certbot-webroot
    owner: 1000
    group: 1000
    recurse: yes