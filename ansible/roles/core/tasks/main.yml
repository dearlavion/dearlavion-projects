- name: Ensure Docker Registry login
  include_role:
    name: docker_registry

- name: Remove Core Service container (force redeploy)
  community.docker.docker_container:
    name: dearlavion-core-service
    state: absent
    force_kill: yes

- name: Pull and run Core Service
  community.docker.docker_container:
    name: dearlavion-core-service
    image: "{{ core_image }}"
    pull: yes
    state: started
    restart_policy: always
    networks:
      - name: dearlavion-net
    ports:
      - "{{ core_port }}:{{ core_port }}"

# ----------------------------
# ðŸ”„ Reload nginx AFTER service redeploy
# ----------------------------
- name: Reload nginx after service redeploy
  become: true
  command: docker exec dearlavion-nginx nginx -s reload
  ignore_errors: true
